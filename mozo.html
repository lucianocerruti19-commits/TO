<!DOCTYPE html>
<html>
<head>
  <title>Mozo</title>
</head>
<body>

<h1>Mozo</h1>

<input id="mesa" type="number" placeholder="Mesa">
<div id="menu"></div>
<div id="carrito"></div>

<script type="module">
import { db } from "./firebase.js";
import {
  getDocs,
  collection,
  addDoc,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

let carrito = [];

(async function() {
  const snap = await getDocs(collection(db, "productos"));
  const div = document.getElementById("menu");

  snap.forEach(doc => {
    const p = doc.data();
    div.innerHTML += `
      <div class="card">
        ${p.nombre} - $${p.precio}
        <button onclick="agregar('${p.nombre}', ${p.precio})">Agregar</button>
      </div>
    `;
  });
})();

window.agregar = function(nombre, precio) {
  carrito.push({ nombre, precio });
  render();
};

function render() {
  document.getElementById("carrito").innerHTML = `
    <h2>Carrito</h2>
    ${carrito.map(p => `<div>${p.nombre} - $${p.precio}</div>`).join("")}
    <button onclick="enviar()">Enviar a cocina</button>
  `;
}

window.enviar = async function() {
  const mesa = document.getElementById("mesa").value || "sin mesa";

  await addDoc(collection(db, "pedidos"), {
    mesa,
    items: carrito,
    estado: "pendiente",
    createdAt: serverTimestamp()
  });

  carrito = [];
  alert("Pedido enviado");
};
</script>

</body>
</html>